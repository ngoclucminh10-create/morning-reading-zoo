<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—©è¯»ç¥å™¨ - å£°éŸ³åŠ¨ç‰©å›­</title>
    <link rel="stylesheet" href="styles/style.css">
</head>
<body>
    <!-- HTTPS æç¤º -->
    <div id="https-warning" class="https-warning" style="display: none;">
        <h2>âš ï¸ éœ€è¦å®‰å…¨è¿æ¥</h2>
        <p>æ­¤åº”ç”¨éœ€è¦ HTTPS è¿æ¥æ‰èƒ½è®¿é—®éº¦å…‹é£ã€‚</p>
        <p>è¯·è®¿é—® <a id="https-url"></a></p>
    </div>

    <!-- æ¬¢è¿ç•Œé¢ -->
    <div id="welcome-screen" class="screen active">
        <div class="welcome-content">
            <h1 class="welcome-title">ğŸ‡¨ğŸ‡³ æ—©è¯»ç¥å™¨ ğŸ¾</h1>
            <p class="welcome-subtitle">ç”¨å£°éŸ³åˆ›é€ ä¸€ä¸ªç¥å¥‡çš„åŠ¨ç‰©å›­ï¼</p>
            <div class="welcome-instructions">
                <p>ğŸ“¢ å¤§å£°æœ—è¯»ï¼Œå£°éŸ³è¶Šå¤§ï¼ŒåŠ¨ç‰©è¶Šå¤šï¼</p>
                <p>ğŸ¤ éœ€è¦ä½¿ç”¨éº¦å…‹é£æƒé™</p>
                <p>ğŸ¨ å¯çˆ±çš„åƒç´ é£åŠ¨ç‰©ç­‰ç€ä½ </p>
            </div>
            <button id="welcome-start-btn" class="btn-primary btn-large">å¼€å§‹ä½¿ç”¨</button>
        </div>
    </div>

    <!-- åˆ†äº«é“¾æ¥ -->
    <div id="share-section" class="share-section">
        <button id="share-btn" class="share-btn" title="åˆ†äº«ç»™æœ‹å‹">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"/>
            </svg>
        </button>
        <div id="share-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <h3>åˆ†äº«æ—©è¯»ç¥å™¨</h3>
                <input type="text" id="share-url" readonly>
                <button id="copy-link-btn">å¤åˆ¶é“¾æ¥</button>
                <button id="close-share-btn">å…³é—­</button>
            </div>
        </div>
    </div>

    <!-- ä¸»ç•Œé¢ -->
    <div id="main-screen" class="screen">
        <header class="header">
            <div class="header-left">
                <h1 class="title">ğŸ‡¨ğŸ‡³ æ—©è¯»ç¥å™¨ ğŸ¾</h1>
            </div>
            <div class="header-right">
                <div class="volume-display">
                    <span id="volume-value">0</span> dB
                    <div class="volume-bar">
                        <div id="volume-fill"></div>
                    </div>
                </div>
                <div class="time-display">
                    <span id="current-time">00:00</span>
                </div>
            </div>
        </header>

        <main class="main-content">
            <canvas id="zoo-canvas"></canvas>

            <div class="control-panel">
                <div class="controls-row">
                    <button id="start-btn" class="btn-primary">å¼€å§‹æ—©è¯»</button>
                    <button id="pause-btn" class="btn-secondary" disabled>æš‚åœ</button>
                    <button id="clear-btn" class="btn-secondary">æ¸…ç©ºåŠ¨ç‰©å›­</button>
                    <button id="settings-btn" class="btn-secondary">è®¾ç½®</button>
                </div>

                <div class="speed-row">
                    <div class="speed-controls">
                        <div class="speed-label">ç”Ÿæˆé€Ÿåº¦ï¼š</div>
                        <div class="speed-buttons">
                            <button class="speed-btn" data-speed="0.5">0.5x</button>
                            <button class="speed-btn" data-speed="1">1x</button>
                            <button class="speed-btn active" data-speed="2">2x</button>
                            <button class="speed-btn" data-speed="3">3x</button>
                            <button class="speed-btn" data-speed="5">5x</button>
                        </div>
                        <div class="current-speed-display">
                            å½“å‰: <span id="current-speed-value">2x</span>
                        </div>
                    </div>
                </div>

                <div class="stats-row">
                    <div class="stat-item">
                        <span class="stat-label">åŠ¨ç‰©æ•°é‡ï¼š</span>
                        <span id="animal-count" class="stat-value">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">å¹³å‡éŸ³é‡ï¼š</span>
                        <span id="avg-volume" class="stat-value">0</span> dB
                    </div>
                </div>

                <div class="life-hint">
                    <p>ğŸ’¡ å¤§å£°æœ—è¯»æ‰èƒ½è®©å°åŠ¨ç‰©ç•™ä¸‹æ¥ï¼3ç§’æ²¡å£°éŸ³å°±ä¼šæ¶ˆå¤±å“¦~</p>
                </div>
            </div>
        </main>
    </div>

    <!-- è®¾ç½®é¢æ¿ -->
    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>è®¾ç½®</h2>
                <button class="modal-close" id="close-settings">&times;</button>
            </div>
            <div class="modal-body">
                <div class="settings-section">
                    <h3>åŠ¨ç‰©ç”Ÿæˆé€Ÿåº¦</h3>
                    <div class="slider-control">
                        <input type="range" id="spawn-speed" min="1" max="60" value="10">
                        <div class="slider-labels">
                            <span>å¿«</span>
                            <span id="spawn-speed-value">10ç§’/åª</span>
                            <span>æ…¢</span>
                        </div>
                    </div>
                </div>

                <div class="settings-section">
                    <h3>é€‰æ‹©åŠ¨ç‰©ç§ç±»</h3>
                    <div class="animal-types">
                        <div class="animal-type-row">
                            <button id="select-all" class="btn-small">å…¨é€‰</button>
                            <button id="select-none" class="btn-small">å…¨ä¸é€‰</button>
                        </div>
                        <div class="animal-checkboxes">
                            <label>
                                <input type="checkbox" value="dog" checked>
                                <span>ğŸ• ç‹—</span>
                            </label>
                            <label>
                                <input type="checkbox" value="cat" checked>
                                <span>ğŸ± çŒ«</span>
                            </label>
                            <label>
                                <input type="checkbox" value="rabbit" checked>
                                <span>ğŸ° å…”å­</span>
                            </label>
                            <label>
                                <input type="checkbox" value="bear" checked>
                                <span>ğŸ» ç†Š</span>
                            </label>
                            <label>
                                <input type="checkbox" value="panda" checked>
                                <span>ğŸ¼ ç†ŠçŒ«</span>
                            </label>
                            <label>
                                <input type="checkbox" value="pig" checked>
                                <span>ğŸ· çŒª</span>
                            </label>
                            <label>
                                <input type="checkbox" value="unicorn" checked>
                                <span>ğŸ¦„ ç‹¬è§’å…½</span>
                            </label>
                            <label>
                                <input type="checkbox" value="frog" checked>
                                <span>ğŸ¸ é’è›™</span>
                            </label>
                            <label>
                                <input type="checkbox" value="penguin" checked>
                                <span>ğŸ§ ä¼é¹…</span>
                            </label>
                            <label>
                                <input type="checkbox" value="tiger" checked>
                                <span>ğŸ… è€è™</span>
                            </label>
                            <label>
                                <input type="checkbox" value="fish" checked>
                                <span>ğŸ  é±¼</span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="settings-section">
                    <h3>é«˜çº§è®¾ç½®</h3>
                    <div class="advanced-settings">
                        <label class="setting-item">
                            <span>æœ€å¤§åŠ¨ç‰©æ•°é‡ï¼š</span>
                            <input type="number" id="max-animals" min="10" max="500" value="100">
                        </label>
                        <label class="setting-item">
                            <span>å£°éŸ³é˜ˆå€¼ï¼š</span>
                            <input type="number" id="volume-threshold" min="0" max="100" value="30"> dB
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="save-settings" class="btn-primary">ä¿å­˜è®¾ç½®</button>
                <button id="reset-settings" class="btn-secondary">æ¢å¤é»˜è®¤</button>
            </div>
        </div>
    </div>

    <!-- é”™è¯¯æç¤º -->
    <div id="error-toast" class="toast">
        <span id="error-message"></span>
    </div>

    <!-- JavaScriptæ¨¡å— -->
    <script type="module" src="scripts/main.js"></script>
    <script>
        // HTTPS æ£€æŸ¥
        if (location.protocol !== 'https:' && location.hostname !== 'localhost' && location.hostname !== '127.0.0.1') {
            document.getElementById('https-warning').style.display = 'block';
            document.getElementById('https-url').textContent = `https://${location.hostname}${location.pathname}`;
            document.getElementById('https-url').href = `https://${location.hostname}${location.pathname}`;
        }

        // åˆ†äº«åŠŸèƒ½
        document.getElementById('share-btn').addEventListener('click', () => {
            const modal = document.getElementById('share-modal');
            const urlInput = document.getElementById('share-url');
            urlInput.value = window.location.href;
            modal.style.display = 'flex';
        });

        document.getElementById('copy-link-btn').addEventListener('click', async () => {
            const urlInput = document.getElementById('share-url');
            try {
                await navigator.clipboard.writeText(urlInput.value);
                alert('é“¾æ¥å·²å¤åˆ¶ï¼');
            } catch (err) {
                // é™çº§æ–¹æ¡ˆ
                urlInput.select();
                document.execCommand('copy');
                alert('é“¾æ¥å·²å¤åˆ¶ï¼');
            }
        });

        document.getElementById('close-share-btn').addEventListener('click', () => {
            document.getElementById('share-modal').style.display = 'none';
        });

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        document.getElementById('share-modal').addEventListener('click', (e) => {
            if (e.target.id === 'share-modal') {
                e.target.style.display = 'none';
            }
        });
    </script>

    <style>
        .https-warning {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            padding: 20px;
            text-align: center;
        }

        .https-warning h2 {
            color: #ff6b6b;
            margin-bottom: 20px;
        }

        .https-warning a {
            color: #4ecdc4;
            text-decoration: none;
            font-size: 1.2em;
        }

        .share-section {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }

        .share-btn {
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 50%;
            width: 56px;
            height: 56px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: transform 0.2s;
        }

        .share-btn:hover {
            transform: scale(1.1);
        }

        #share-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1001;
        }

        #share-modal .modal-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            max-width: 500px;
            width: 90%;
        }

        #share-url {
            width: 100%;
            padding: 10px;
            margin: 20px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        #share-modal button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        #copy-link-btn {
            background: #4CAF50;
            color: white;
        }

        #close-share-btn {
            background: #f44336;
            color: white;
        }
    </style>
</body>
</html>